{% extends 'base.html' %}

{% block add_links %}
    <!-- Include stylesheet for Quill and Code Mirror-->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.49.2/lib/codemirror.css') }}">


{% endblock %}
<script type="text/javascript">
    $('#issue_form').on('submit', function () {
        alert('Form submitted!');     
    });
</script>


{% block inner_title%}Issue Logging{% endblock %}

{% block header %}
    <h1>{% block title %}New issue{% endblock %}</h1>
{% endblock %}

{% block content %}
    <form action="{{ url_for('logger.parse_query') }}" method="POST">
        <!-- Create the sql editor -->
        <label for="sql_editor">SQL Query</label>
        {% if query %}
            <textarea name="sql_script" id="sql_editor">{{query}}</textarea>
        {% else %}
            <textarea name="sql_script" id="sql_editor"></textarea>
        {% endif %}
        <hr>
        <input type="submit" value="Parse Query">

        <label for="objs_verbs">Objects & Verbs</label>
        {% if objs_verbs %}
            <output name="objs_verbs_output" id="objs_verbs">{{objs_verbs}}</output>
        {% else %}
            <output name="objs_verbs_output" id="objs_verbs"></output>
        {% endif %}
        <hr>
    </form>

    <form id="issue_form" onsumbit="get_issue_body_contents();" action="{{ url_for('logger.create_issue') }}" method="POST">
        <label for="issue_label">Issue Label</label>
        <input type="text" id="issue_label">
        <hr>
        <label for="editor">Issue Body</label>
        <!-- Create the editor container -->
        <div id="editor"></div>
        <textarea name="issue_body" id="issue_body" hidden></textarea>
        <hr>
        <input type="submit" value="Log Issue">
    </form>
{% endblock %}

{% block scripts %}

    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>  
    <!-- Initialize Quill editor -->
    <script type=text/javascript>

        var toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
        ['blockquote', 'code-block'],
        
        //[{ 'header': 1 }, { 'header': 2 }],               // custom button values
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
        //[{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
        [{ 'direction': 'rtl' }],                         // text direction
        
        [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
        
        [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
        [{ 'font': [] }],
        [{ 'align': [] }],
        
        ['clean']                                         // remove formatting button
        ];

        var quill = new Quill('#editor', {
            modules: {
                toolbar:toolbarOptions
            },
            theme: 'snow'
        });

    </script>

    <script src="{{ url_for('static', filename='codemirror-5.49.2/lib/codemirror.js')}}"></script>
    <script src="{{ url_for('static', filename='codemirror-5.49.2/mode/sql/sql.js')}}"></script>

    <script type=text/javascript>
        var txtArea = document.getElementById("sql_editor");
        var cmEditor = CodeMirror.fromTextArea(txtArea,{
            lineNumbers : true
        });

    </script>

{% endblock %}